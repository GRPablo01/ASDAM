<!-- ✅ Bouton compact : Créer un post -->
<div class="flex justify-center mt-6 px-4 sm:px-6 lg:px-0" *ngIf="canCreatePost()">
  <button
    type="button"
    (click)="openCreatePostModal()"
    aria-label="Créer un nouveau post"
    class="group flex flex-col items-center justify-center w-28 h-28
          bg-gradient-to-br from-[var(--Rouge-Foncé)] to-[var(--Rouge)]
          text-[var(--Blanc)] font-semibold rounded-xl shadow-md
          hover:from-[var(--Bleu)] hover:to-[var(--Bleu-Foncé)]
          hover:shadow-lg hover:-translate-y-0.5 hover:scale-105
          transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-rose-400/40"
  >
    <i class="fa-solid fa-pen-to-square text-2xl mb-1 transition-transform duration-300 group-hover:rotate-12"></i>
    <span class="uppercase tracking-wide text-xs leading-tight">Créer</span>
    <span class="text-[10px] opacity-80">Post</span>
  </button>
</div>

<!-- Contenu principal -->
<div class="relative z-10 max-w-3xl mx-auto px-4 sm:px-6 lg:px-0 py-8 space-y-6">
  <!-- Modal créer post -->
  <!-- ✅ Modal de Création de Post -->
  <div *ngIf="showCreateModal" 
       class="fixed w-full h-full inset-0 z-100 flex items-center justify-center bg-[var(--Black)]/40 backdrop-blur-lg p-4">
    <div class="w-full max-w-lg rounded-3xl bg-white/90 backdrop-blur-2xl border border-gray-300 shadow-2xl p-8 text-[var(--Black)] relative overflow-y-auto max-h-[90vh]">

      <button (click)="closeCreatePostModal()" aria-label="Fermer"
        class="absolute top-4 right-4 w-10 h-10 flex items-center justify-center rounded-full bg-gray-200 hover:bg-[var(--Rouge)]/20 text-[var(--Black)] transition-all duration-300 shadow-md">
        <i class="fa-solid fa-xmark text-lg"></i>
      </button>

      <h2 class="text-2xl font-bold mb-6 text-[var(--Rouge)]">Créer un post</h2>

      <textarea [(ngModel)]="newPostContent" placeholder="Quoi de neuf ?"
        class="w-full p-4 bg-white border-2 border-gray-300 rounded-2xl placeholder-gray-500 text-[var(--Black)] text-base resize-none
               focus:outline-none focus:ring-2 focus:ring-[var(--Rouge)] focus:border-[var(--Rouge)] transition-all duration-300"></textarea>

      <!-- Aperçu média -->
      <div *ngIf="newPostMediaPreview" class="mt-4 relative">
        <img *ngIf="newPostMedia?.type?.startsWith('image/')" [src]="newPostMediaPreview" class="rounded-xl max-h-80 w-full object-cover" />
        <video *ngIf="newPostMedia?.type?.startsWith('video/')" [src]="newPostMediaPreview" class="rounded-xl max-h-80 w-full" controls></video>
        <button (click)="removeMedia()" aria-label="Supprimer le média"
          class="absolute top-2 right-2 w-10 h-10 flex items-center justify-center bg-[var(--Rouge)] hover:bg-[var(--Bleu)] text-white rounded-full transition-all duration-300 shadow-md">
          <i class="fa-solid fa-xmark text-lg"></i>
        </button>
      </div>

      <!-- Zone de drop -->
      <div *ngIf="!newPostMediaPreview" 
        (drop)="onDrop($event)" 
        (dragover)="onDragOver($event)"
        class="mt-4 border-2 border-dashed border-gray-400 rounded-2xl p-8 text-center cursor-pointer hover:border-[var(--Rouge)] hover:bg-gray-100 transition-all duration-300 flex flex-col items-center justify-center">

        <input type="file" #mediaInput class="hidden" (change)="onMediaSelected($event)" accept="image/*,video/*" />

        <button (click)="mediaInput.click()" type="button" class="flex flex-col items-center justify-center focus:outline-none">
          <i class="fa-regular fa-image text-4xl text-gray-500 mb-3 transition-transform group-hover:scale-110"></i>
          <span class="text-gray-600 text-base md:text-sm">Glisse une image ou vidéo ici</span>
        </button>

        <p class="mt-3 text-xs text-gray-400">Ou cliquez pour sélectionner un fichier</p>
      </div>

      <!-- Actions -->
      <div class="flex items-center justify-between mt-6">
        <button (click)="openMediaSelector()" type="button"
          class="flex items-center gap-2 px-4 py-2 bg-[var(--Rouge)] hover:bg-[var(--Bleu)] text-white rounded-xl transition">
          <i class="fa-regular fa-image"></i>
          <span>Ajouter média</span>
        </button>

        <button (click)="createPost()" [disabled]="loading || !newPostContent.trim()"
          class="px-6 py-2 bg-gradient-to-r from-[var(--Rouge-Foncé)] to-[var(--Rouge)] hover:from-[var(--Bleu-Foncé)] hover:to-[var(--Bleu)]
                 text-white rounded-xl font-medium shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition">
          <span *ngIf="!loading">Publier</span>
          <span *ngIf="loading" class="flex items-center gap-2">
            <i class="fa-solid fa-spinner fa-spin"></i> Publication...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Animations -->
<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fadeIn {
    animation: fadeIn 0.3s ease-out;
  }

  .animate-slideUp {
    animation: slideUp 0.3s ease-out;
  }
</style>