<!-- ‚úÖ Bouton compact : Cr√©er un post -->
<div class="flex justify-center mt-6 px-4 sm:px-6 lg:px-0" *ngIf="canCreatePost()">
  <button type="button"
          (click)="openCreatePostModal()"
          aria-label="Cr√©er un nouveau post"
          class="group flex flex-col items-center justify-center w-28 h-28
                 bg-gradient-to-br from-[var(--Rouge-Fonc√©)] to-[var(--Rouge)]
                 text-[var(--Blanc)] font-semibold rounded-xl shadow-md
                 hover:from-[var(--Bleu)] hover:to-[var(--Bleu-Fonc√©)]
                 hover:shadow-lg hover:-translate-y-0.5 hover:scale-105
                 transition-all duration-300 ease-out
                 focus:outline-none focus:ring-2 focus:ring-rose-400/40">
    <i class="fa-solid fa-pen-to-square text-2xl mb-1 transition-transform duration-300 group-hover:rotate-12 text-white"></i>
    <span class="uppercase tracking-wide text-xs leading-tight text-white">Cr√©er</span>
    <span class="text-[10px] opacity-80 text-white">Post</span>
  </button>
</div>


<!-- ‚úÖ MODAL DE CR√âATION DE POST -->
<div *ngIf="showCreateModal"
     class="fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6 bg-black/70 backdrop-blur-md animate-fade-in"
     (click)="closeCreatePostModal()">

  <div class="bg-white/95 dark:bg-[var(--Black)]/90 rounded-3xl p-6 sm:p-8 max-w-2xl w-full mx-4 shadow-2xl border border-gray-100 dark:border-gray-700 animate-scale-in overflow-y-auto max-h-[90vh]"
       (click)="$event.stopPropagation()">

    <!-- HEADER -->
    <div class="flex items-center justify-between mb-8 relative">
      <h2 class="text-3xl font-bold bg-gradient-to-r from-[var(--Rouge)] to-[var(--Rouge-Fonc√©)] bg-clip-text text-transparent dark:from-[var(--Rouge-Clair)] dark:to-[var(--Bleu-Clair)]">
        Cr√©er un post
      </h2>
      <button (click)="closeCreatePostModal()"
              class="text-gray-500 dark:text-gray-300 hover:text-[var(--Rouge)] text-3xl font-light w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-white/10 transition-all duration-300 hover:rotate-90">
        ‚úï
      </button>
    </div>

    <!-- CONTENU -->
    <div class="space-y-6">
      <!-- Champ texte -->
      <textarea [(ngModel)]="newPostContent" placeholder="Quoi de neuf ?"
        class="w-full p-4 bg-white dark:bg-[var(--Gris)]/30 border-2 border-gray-200 dark:border-gray-700 rounded-2xl placeholder-gray-500 text-[var(--Black)] dark:text-[var(--Blanc)] text-base resize-none
                 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge)] focus:border-[var(--Rouge)] transition-all duration-300"></textarea>

      <!-- Aper√ßu m√©dia -->
      <div *ngIf="newPostMediaPreview" class="mt-4 relative animate-fade-in-up">
        <img *ngIf="newPostMedia?.type?.startsWith('image/')" [src]="newPostMediaPreview"
             class="rounded-2xl max-h-80 w-full object-cover shadow-md" />
        <video *ngIf="newPostMedia?.type?.startsWith('video/')" [src]="newPostMediaPreview"
               class="rounded-2xl max-h-80 w-full shadow-md" controls></video>
        <button (click)="removeMedia()" aria-label="Supprimer le m√©dia"
          class="absolute top-3 right-3 w-10 h-10 flex items-center justify-center bg-[var(--Rouge)] hover:bg-[var(--Bleu)] text-white rounded-full shadow-lg transition-all duration-300">
          <i class="fa-solid fa-xmark text-lg"></i>
        </button>
      </div>

      <!-- Zone de drop -->
      <div *ngIf="!newPostMediaPreview"
           (drop)="onDrop($event)"
           (dragover)="onDragOver($event)"
           class="mt-4 border-2 border-dashed border-gray-400 rounded-2xl p-8 text-center cursor-pointer hover:border-[var(--Rouge)] hover:bg-gray-100 dark:hover:bg-[var(--Gris)]/30 transition-all duration-300 flex flex-col items-center justify-center">

        <input type="file" #mediaInput class="hidden" (change)="onMediaSelected($event)" accept="image/*,video/*" />

        <button (click)="mediaInput.click()" type="button"
                class="flex flex-col items-center justify-center focus:outline-none">
          <i class="fa-regular fa-image text-4xl text-gray-500 mb-3 transition-transform group-hover:scale-110"></i>
          <span class="text-gray-600 dark:text-gray-300 text-base md:text-sm">Glisse une image ou vid√©o ici</span>
        </button>

        <p class="mt-3 text-xs text-gray-400 dark:text-gray-500">Ou clique pour s√©lectionner un fichier</p>
      </div>

      <!-- Boutons d'action -->
      <div class="flex items-center justify-between mt-8">
        <button (click)="openMediaSelector()" type="button"
          class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[var(--Rouge)] to-[var(--Rouge-Fonc√©)] hover:from-[var(--Bleu)] hover:to-[var(--Bleu-Fonc√©)] text-white rounded-xl shadow-md hover:shadow-lg transition-all duration-300">
          <i class="fa-regular fa-image"></i>
          <span>Ajouter m√©dia</span>
        </button>

        <button (click)="createPost()" [disabled]="loading || !newPostContent.trim()"
          class="px-6 py-3 bg-gradient-to-r from-[var(--Rouge-Fonc√©)] to-[var(--Rouge)] hover:from-[var(--Bleu-Fonc√©)] hover:to-[var(--Bleu)]
                   text-white rounded-xl font-semibold shadow-lg hover:scale-105 transition-transform duration-200 disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden">
          <span [class.invisible]="loading">{{ loading ? 'Publication...' : 'Publier' }}</span>
          <div *ngIf="loading" class="absolute inset-0 flex items-center justify-center">
            <i class="fa-solid fa-spinner fa-spin text-xl"></i>
          </div>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- üé® Animations -->
<style>
  @keyframes fade-in {
    0% { opacity: 0; } 100% { opacity: 1; }
  }
  @keyframes scale-in {
    0% { opacity: 0; transform: scale(0.95); }
    100% { opacity: 1; transform: scale(1); }
  }
  @keyframes fade-in-up {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in { animation: fade-in 0.3s ease-out; }
  .animate-scale-in { animation: scale-in 0.3s ease-out; }
  .animate-fade-in-up { animation: fade-in-up 0.4s ease-out; }

  /* Scrollbar stylis√©e */
  ::-webkit-scrollbar { width: 8px; }
  ::-webkit-scrollbar-thumb {
    background: linear-gradient(to bottom, var(--Rouge), var(--Bleu));
    border-radius: 10px;
  }
</style>